CREATE TABLE AUTHORS (AUTHOR_ID NUMBER PRIMARY KEY,AUTHOR_NAME VARCHAR2(255) NOT NULL,NATIONALITY VARCHAR2(100));
CREATE TABLE BOOKS (BOOK_ID NUMBER PRIMARY KEY,TITLE VARCHAR2(255) NOT NULL,GENRE VARCHAR2(100),AUTHOR_ID NUMBER,AVAILABLE_COPIES NUMBER DEFAULT 0,CONSTRAINT FK_BOOKS_AUTHOR FOREIGN KEY (AUTHOR_ID) REFERENCES AUTHORS(AUTHOR_ID));
CREATE TABLE BORROWERS (BORROWER_ID NUMBER PRIMARY KEY,BORROWER_NAME VARCHAR2(255) NOT NULL,EMAIL VARCHAR2(255) UNIQUE,PHONE VARCHAR2(20));
CREATE TABLE BORROWEDBOOKS (BORROW_ID NUMBER PRIMARY KEY,BORROWER_ID NUMBER,BOOK_ID NUMBER,BORROW_DATE DATE DEFAULT SYSDATE,RETURN_DATE DATE,STATUS VARCHAR2(50) CHECK (STATUS IN ('Borrowed', 'Returned', 'Overdue')),CONSTRAINT FK_BORROWEDBOOKS_BORROWER FOREIGN KEY (BORROWER_ID) REFERENCES BORROWERS(BORROWER_ID),CONSTRAINT FK_BORROWEDBOOKS_BOOK FOREIGN KEY (BOOK_ID) REFERENCES BOOKS(BOOK_ID));
CREATE TABLE LIBRARYTRANSACTIONS (TRANSACTION_ID NUMBER PRIMARY KEY,BORROWER_ID NUMBER,BOOK_ID NUMBER,AUTHOR_ID NUMBER,BORROW_DATE DATE DEFAULT SYSDATE,RETURN_DATE DATE,STATUS VARCHAR2(50) CHECK (STATUS IN ('Borrowed', 'Returned', 'Overdue')),CONSTRAINT FK_LIBRARYTRANSACTIONS_BORROWER FOREIGN KEY (BORROWER_ID) REFERENCES BORROWERS(BORROWER_ID),CONSTRAINT FK_LIBRARYTRANSACTIONS_BOOK FOREIGN KEY (BOOK_ID) REFERENCES BOOKS(BOOK_ID),CONSTRAINT FK_LIBRARYTRANSACTIONS_AUTHOR FOREIGN KEY (AUTHOR_ID) REFERENCES AUTHORS(AUTHOR_ID));

INSERT INTO AUTHORS VALUES('1', 'Jane Mbabazi', 'Rwanda');
INSERT INTO AUTHORS VALUES('2', 'Leo Pascal', 'Angola');
INSERT INTO AUTHORS VALUES('3', 'Ernest Igihozo', 'Rwanda');

INSERT INTO BOOKS VALUES('101', 'Pride and Prejudice', 'Romance', 1, 2003,);
INSERT INTO BOOKS VALUES ('203', 'War and Peace', 'Historical Novel', 2, 1997,);
INSERT INTO BOOKS VALUES ('307', 'The Old Man and the Sea','Novel', 3, 2012,);

INSERT INTO BORROWERS VALUES('16', 'Alice', 'Ainembabazi', 'alicea@gmail.com', '+254786958');
INSERT INTO BORROWERS VALUES('18', 'Bob', 'Ineza', 'ibob23@gmail.com', '+11179303245');

INSERT INTO BORROWEDBOOKS VALUES('10', '18', '307','26-OCTOBER-2023', NULL);
INSERT INTO BORROWEDBOOKS VALUES('23', '16', '203','3-APRIL-2002', '12-JUNE-2002');

UPDATE AUTHORS SET NATIONALITY = 'South Africa' WHERE AUTHOR_ID = 3;
UPDATE BOOKS SET PUBLISHED_YEAR = 2000 WHERE BOOK_ID = 203;
UPDATE BORROWERS SET ADDRESS = 'KK 254 AV 20' WHERE BORROWER_ID = 18;
UPDATE BORROWEDBOOKS SET RETURN_DATE = '7-NOVEMBER-2023' WHERE BORROWED_ID = 10;

DELETE FROM BOOKS WHERE BOOK_ID = 101;
DELETE FROM BORROWERS WHERE BORROWER_ID = 16;
DELETE FROM AUTHORS WHERE AUTHOR_ID = 1;
DELETE FROM BORROWEDBOOKS WHERE BORROWED_ID = 23;

SELECT BOOKS.TITLE, AUTHOR_NAME
FROM BOOKS
JOIN AUTHORS ON BOOKS.AUTHOR_ID = AUTHORS.AUTHOR_ID;
SELECT AUTHORS.AUTHOR_NAME, BOOKS.TITLE
FROM AUTHORS
LEFT JOIN BOOKS ON AUTHORS.AUTHOR_ID= BOOKS.AUTHOR_ID;
SELECT BORROWERS.BORROWER_NAME,, BOOKS.TITLE
FROM BORROWEDBOOKS
JOIN BORROWERS ON BORROWEDBOOKS.BORROWER_ID = BORROWERS.BORROWER_ID
JOIN BOOKS ON BORROWEDBOOKS.BOOK_ID = BOOKS.BOOK_ID;
SELECT BORROWERS.BORROWER_NAME, BOOKS.TITLE
FROM BORROWEDBOOKS
JOIN BORROWERS ON BORROWEDBOOKS.BORROWER_ID = BORROWERS.BORROWER_ID
JOIN BOOKS ON BORROWEDBOOKS.BOOK_ID = BOOKS.BOOK_ID
WHERE BORROWEDBOOKS.RETURN_DATE IS NOT NULL;
INSERT INTO BORROWEDBOOKS VALUES ('30', '307','18', '1-FEBRUARY-2024', '30-AUGUST-2024');
 
ROLLBACK;

COMMIT; 

SELECT TITLE
FROM BOOKS
WHERE AUTHOR_ID IN (SELECT AUTHOR_ID FROM AUTHORS WHERE NATIONALITY = 'Rwanda');
SELECT *
FROM BORROWEDBOOKS
WHERE BORROWEDDATE >= SYSDATE - 7;
UPDATE BORROWEDBOOKS SET BORROWED_DATE = '25-FEBRUARY-2025' WHERE BORROWED_ID = '10';
SELECT b.book_id, b.title, b.genre, a.author_name, a.country
FROM Books b
INNER JOIN Authors a ON b.author_id = a.author_id;
SELECT bb.borrow_id, bo.borrower_name, bo.email, bb.book_id, b.title, bb.borrow_date, bb.return_date, bb.status
FROM BorrowedBooks bb
INNER JOIN Borrowers bo ON bb.borrower_id = bo.borrower_id
INNER JOIN Books b ON bb.book_id = b.book_id;
SELECT bo.borrower_id, bo.borrower_name, bb.book_id, b.title, bb.borrow_date, bb.status
FROM Borrowers bo
LEFT JOIN BorrowedBooks bb ON bo.borrower_id = bb.borrower_id
LEFT JOIN Books b ON bb.book_id = b.book_id;
SELECT b.book_id, b.title, b.genre, bb.borrow_id, bo.borrower_name, bb.borrow_date
FROM Books b
LEFT JOIN BorrowedBooks bb ON b.book_id = bb.book_id
LEFT JOIN Borrowers bo ON bb.borrower_id = bo.borrower_id;
SELECT a.author_id, a.author_name, b.book_id, b.title, b.genre
FROM Books b
RIGHT JOIN Authors a ON b.author_id = a.author_id;
SELECT bo.borrower_id, bo.borrower_name, lt.transaction_id, lt.book_id, lt.borrow_date, lt.status
FROM Borrowers bo
FULL OUTER JOIN LibraryTransactions lt ON bo.borrower_id = lt.borrower_id;
SELECT bo.borrower_name, b.title
FROM Borrowers bo
CROSS JOIN Books b;
 \
